# Сводка по системе федеративного обучения

## Что было создано

### 1. Сервер агрегации весов (`flower_server/`)
- **server.py** - сервер Flower для агрегации весов моделей от клиентов
- **model.py** - нейронная сеть для предсказания стоимости страхования (17 входных признаков)
- Использует стратегию FedAvg для усреднения весов
- Сохраняет модель после каждого раунда

### 2. Три клиента (`flower_client/`)
- **client.py** - клиент Flower для локального обучения
- **data_loader.py** - загрузка и предобработка данных из CSV файлов
- Каждый клиент получает ~1/3 данных (16,666-16,667 записей)
- Клиенты обучаются локально и отправляют обновленные веса на сервер

### 3. Скрипты запуска (`scripts/`)
- **run_federated_learning.py** - автоматический запуск сервера и всех клиентов
- **start_server.bat/sh** - запуск сервера
- **start_client.bat/sh** - запуск клиента
- **test_model.py** - тестирование обученной модели

### 4. Документация
- **FLOWER_SETUP.md** - подробная инструкция по установке и запуску
- **FEDERATED_LEARNING_SUMMARY.md** - этот файл

## Архитектура модели

**Входные признаки (17):**
- Базовые: возраст, пол, BMI, количество детей, статус курения (5)
- Физические: рост, вес, систолическое АД, диастолическое АД, пульс (5)
- Здоровье: холестерин, глюкоза, уровень активности (3)
- Регион: one-hot encoding (4 региона)

**Архитектура сети:**
- Входной слой: 17 → 256
- Скрытые слои: 256 → 128 → 64 → 32
- Выходной слой: 32 → 1
- Batch Normalization и Dropout для регуляризации

## Распределение данных

- **Клиент 1**: пациенты 1-16,666 (~16,666 записей)
- **Клиент 2**: пациенты 16,667-33,333 (~16,667 записей)  
- **Клиент 3**: пациенты 33,334-50,000 (~16,666 записей)

## Процесс обучения

1. Сервер инициализирует модель с случайными весами
2. Сервер отправляет веса всем клиентам
3. Каждый клиент обучает модель на своих данных (5 эпох)
4. Клиенты отправляют обновленные веса обратно
5. Сервер агрегирует веса (FedAvg - усреднение)
6. Процесс повторяется 10 раундов
7. Финальная модель сохраняется в `flower_server/models/active_model.pt`

## Быстрый старт

```bash
# 1. Установить зависимости
pip install -r flower_server/requirements.txt
pip install -r flower_client/requirements.txt

# 2. Запустить систему (автоматически)
python scripts/run_federated_learning.py

# Или вручную:
# Терминал 1: python flower_server/server.py
# Терминал 2: python flower_client/client.py --client-id 1
# Терминал 3: python flower_client/client.py --client-id 2
# Терминал 4: python flower_client/client.py --client-id 3

# 3. Протестировать модель
python scripts/test_model.py
```

## Преимущества федеративного обучения

1. **Приватность данных** - данные остаются на клиентах, не передаются на сервер
2. **Масштабируемость** - легко добавить больше клиентов
3. **Распределенная обработка** - обучение происходит параллельно на клиентах
4. **Реалистичность** - каждый клиент может представлять отдельное медицинское учреждение

## Технологии

- **Flower.ai** - фреймворк для федеративного обучения
- **PyTorch** - глубокое обучение
- **Pandas** - обработка данных
- **NumPy** - численные вычисления

## Следующие шаги

1. Запустить обучение и дождаться завершения
2. Протестировать модель на новых данных
3. Оценить метрики (MAE, RMSE)
4. При необходимости настроить гиперпараметры (learning rate, batch size, epochs)
5. Интегрировать модель в production систему


